// Schema para MySQL con enums
// Para usar este schema:
// 1. Copia este archivo sobre schema.prisma
// 2. Cambia DATABASE_URL en .env a MySQL
// 3. Ejecuta: npx prisma migrate dev

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  USER
  SPECIAL_USER
}

enum ReservationStatus {
  LIBRE
  PRE_RESERVADA
  RESERVADA
  NO_DISPONIBLE
}

enum PaymentStatus {
  PENDIENTE
  APROBADO
  RECHAZADO
}

model User {
  id            String    @id @default(uuid())
  nombre        String
  email         String    @unique
  dni           String    @unique
  passwordHash  String
  role          UserRole  @default(USER)
  specialRolePending Boolean @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  reservations  Reservation[]
  logs          Log[]

  @@map("users")
}

model Space {
  id            String    @id @default(uuid())
  nombre        String
  tipo          String
  precioBase    Float
  precioEspecial Float
  luzPrecio     Float     @default(5.0)
  luzIncluida   Boolean   @default(false)
  disponible    Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  reservations  Reservation[]

  @@map("spaces")
}

model Reservation {
  id            String            @id @default(uuid())
  userId        String
  spaceId       String
  fecha         DateTime
  franja        String
  estado        ReservationStatus @default(PRE_RESERVADA)
  precioTotal   Float
  luz           Boolean           @default(false)
  dni           String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  user          User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  space         Space             @relation(fields: [spaceId], references: [id], onDelete: Cascade)
  payment       Payment?
  logs          Log[]

  @@unique([spaceId, fecha, franja])
  @@map("reservations")
}

model Payment {
  id            String        @id @default(uuid())
  reservationId String        @unique
  amount        Float
  status        PaymentStatus @default(PENDIENTE)
  comprobanteUrl String?
  motivoRechazo String?
  numeroCuenta  String        @default("ES12 3456 7890 1234 5678 9012")
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  reservation   Reservation   @relation(fields: [reservationId], references: [id], onDelete: Cascade)

  @@map("payments")
}

model Log {
  id            String    @id @default(uuid())
  reservationId String?
  action        String
  userId        String?
  detalles      String?
  timestamp     DateTime  @default(now())

  reservation   Reservation? @relation(fields: [reservationId], references: [id], onDelete: SetNull)
  user          User?        @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@map("logs")
}

